<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒå ´é›»å­çœ‹æ¿ - è¥¿å¯§åœ‹å°ç‰ˆ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Roboto+Mono:wght@500;700&display=swap');

        /* --- å…¨åŸŸè®Šæ•¸èˆ‡é…è‰² --- */
        :root {
            --bg-gradient-1: #e0eafc;
            --bg-gradient-2: #cfdef3;
            --card-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.5);
            --shadow-light: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            
            --text-primary: #2d3436;
            --text-secondary: #636e72;
            --accent-color: #0984e3;
            
            /* ç‹€æ…‹è‰² */
            --active-bg: linear-gradient(120deg, #f6d365 0%, #fda085 100%);
            --active-text: #fff;
            --active-shadow: 0 4px 15px rgba(253, 160, 133, 0.4);
            
            /* HP è¡€æ¢é¡è‰² */
            --hp-high: #00b894; 
            --hp-mid: #fdcb6e;
            --hp-low: #ff7675;
        }

        body {
            font-family: 'Noto Sans TC', "Microsoft JhengHei", sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-gradient-1) 0%, var(--bg-gradient-2) 100%);
            height: 100vh;
            color: var(--text-primary);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ä¸»å®¹å™¨ */
        .container {
            width: 96%;
            height: 94%;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-light);
            display: grid;
            grid-template-columns: 35% 65%;
            grid-template-rows: 25% 55% 20%;
            overflow: hidden;
        }

        /* --- 1. å·¦ä¸Šï¼šæ™‚é˜å€ --- */
        .clock-section {
            background: rgba(255, 255, 255, 0.4);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            border-right: 1px solid rgba(0,0,0,0.05);
        }

        .clock-label { 
            font-size: 1.5rem;
            color: var(--text-secondary); 
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
        
        .clock-time { 
            font-size: 5rem; 
            font-weight: 700; 
            font-family: 'Roboto Mono', monospace; 
            color: var(--text-primary);
            letter-spacing: -2px;
            background: -webkit-linear-gradient(#2d3436, #636e72);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- 2. å³å´ï¼šä¸»è¨Šæ¯å€ --- */
        .message-section {
            grid-column: 2 / 3;
            grid-row: 1 / 4;
            background: rgba(255, 255, 255, 0.6);
            display: flex;
            flex-direction: column;
            border-left: 1px solid rgba(255,255,255,0.8);
        }

        /* Boss Battle Area */
        .boss-battle-area {
            background: white;
            margin: 30px;
            padding: 25px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 30px;
            border: 1px solid rgba(0,0,0,0.03);
        }

        .boss-avatar {
            font-size: 4.5rem;
            min-width: 90px;
            text-align: center;
            cursor: pointer;
            user-select: none;
            filter: drop-shadow(0 8px 10px rgba(0,0,0,0.15));
            transform-origin: center bottom;
        }
        
        /* === Boss Avatar Animations === */
        @keyframes float-breath {
            0% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
            100% { transform: translateY(0px) scale(1); }
        }
        .anim-float { animation: float-breath 3s ease-in-out infinite; }

        @keyframes nervous-shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .anim-shake { animation: nervous-shake 0.8s infinite; }

        @keyframes violent-shake {
            0% { transform: translate(0, 0) scale(1.2); }
            25% { transform: translate(-5px, 5px) scale(1.2); }
            50% { transform: translate(5px, -5px) scale(1.2); }
            75% { transform: translate(-5px, -5px) scale(1.2); }
            100% { transform: translate(0, 0) scale(1.2); }
        }
        .anim-angry { animation: violent-shake 0.1s infinite; filter: drop-shadow(0 0 15px rgba(255, 0, 0, 0.6)) !important; }

        @keyframes sad-bounce {
            0%, 100% { transform: scale(1, 1) translateY(0); }
            10% { transform: scale(1.1, 0.9) translateY(0); }
            30% { transform: scale(0.9, 1.1) translateY(-20px); }
            50% { transform: scale(1, 1) translateY(0); }
            57% { transform: scale(1, 1) translateY(-7px); }
            64% { transform: scale(1, 1) translateY(0); }
            100% { transform: scale(1, 1) translateY(0); }
        }
        .anim-cry { animation: sad-bounce 1.5s infinite; }

        .boss-avatar:active {
            transform: scale(0.8) !important;
            animation: none !important;
        }

        .hp-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .hp-text {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            font-weight: 900;
            color: var(--text-primary);
        }
        .hp-text .boss-name { font-size: 2rem; }
        .hp-text .boss-timer { font-size: 1.8rem; font-family: 'Roboto Mono', monospace; color: var(--text-secondary); }

        /* é€²åº¦æ¢å¤–æ¡† - ä¿®æ”¹ç‚º visible è®“æé¾å¯ä»¥å‡¸å‡ºä¾† */
        .hp-bar-frame {
            height: 40px;
            background-color: #dfe6e9;
            border-radius: 20px;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.1);
            position: relative;
            overflow: visible; /* é—œéµï¼šè®“æé¾ä¸è¢«åˆ‡æ‰ */
            margin-top: 20px; /* å¢åŠ ä¸Šæ–¹ç©ºé–“çµ¦æé¾ */
        }

        /* é€²åº¦æ¢å¡«å…… - åŠ å…¥åœ“è§’ */
        .hp-bar-fill {
            height: 100%;
            width: 100%;
            background: var(--hp-high);
            border-radius: 20px;
            transition: width 0.5s linear, background 0.5s;
            position: relative;
            
            /* æ¢ç´‹èƒŒæ™¯ */
            background-image: linear-gradient(
                45deg, 
                rgba(255, 255, 255, 0.2) 25%, 
                transparent 25%, 
                transparent 50%, 
                rgba(255, 255, 255, 0.2) 50%, 
                rgba(255, 255, 255, 0.2) 75%, 
                transparent 75%, 
                transparent
            );
            background-size: 40px 40px;
            animation: stripe-move 2s linear infinite;
        }

        /* æé¾è·‘è€… */
        .dino-runner {
            position: absolute;
            right: -25px; /* èª¿æ•´ä½ç½®åœ¨é€²åº¦æ¢æœ«ç«¯ */
            top: -45px;   /* ç«™åœ¨é€²åº¦æ¢ä¸Šæ–¹ */
            font-size: 3rem;
            transform: scaleX(-1); /* é¢å‘å·¦é‚Š (å› ç‚ºæ™‚é–“æ¸›å°‘æ˜¯å¾€å·¦) */
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2));
            animation: dino-walk 0.6s ease-in-out infinite alternate;
            z-index: 5;
            pointer-events: none; /* ä¸å¹²æ“¾é»æ“Š */
        }

        @keyframes dino-walk {
            0% { transform: scaleX(-1) translateY(0) rotate(0deg); }
            100% { transform: scaleX(-1) translateY(-5px) rotate(-5deg); }
        }

        @keyframes stripe-move {
            0% { background-position: 0 0; }
            100% { background-position: 40px 0; }
        }

        /* æé†’å¤§å­— (æ”¯æ´è·‘é¦¬ç‡ˆ) */
        .reminder-area {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 5rem;
            font-weight: 900;
            text-align: center;
            padding: 30px;
            color: var(--text-primary);
            text-shadow: 2px 2px 0px rgba(255,255,255,0.8);
            overflow: hidden; 
            position: relative;
        }

        #main-reminder {
            width: 100%;
            white-space: pre-wrap;
            line-height: 1.3;
        }

        .reminder-area.marquee-active #main-reminder {
            width: auto;
            white-space: nowrap;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            animation: reminder-scroll 20s linear infinite;
            padding-left: 100%;
            display: inline-block;
        }

        @keyframes reminder-scroll {
            from { transform: translate(0, -50%); }
            to { transform: translate(-100%, -50%); left: 0; } 
        }

        /* --- 3. å·¦ä¸­ï¼šèª²è¡¨å€ --- */
        .schedule-section {
            grid-row: 2 / 3;
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px; 
            border-right: 1px solid rgba(0,0,0,0.05);
            overflow-y: auto;
        }

        .schedule-row {
            flex: 1;
            background: white;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 35px;
            color: var(--text-secondary);
            font-size: 2rem;
            font-weight: 700;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid transparent;
        }

        .schedule-row .subject-time {
            font-family: 'Roboto Mono', monospace;
            font-size: 1.8rem;
            opacity: 0.8;
        }

        .schedule-row.active {
            background: var(--active-bg);
            color: var(--active-text);
            box-shadow: var(--active-shadow);
            transform: scale(1.02);
            border: none;
            z-index: 10;
        }
        .schedule-row.active .subject-time { opacity: 1; }

        /* --- 4. å·¦ä¸‹ï¼šè€ƒå‹¤çµ±è¨ˆå€ --- */
        .attendance-section {
            grid-row: 3 / 4;
            background: #fff;
            border-right: 1px solid rgba(0,0,0,0.05);
            border-top: 1px solid rgba(0,0,0,0.05);
            display: grid;
            grid-template-columns: 1fr 1fr 2fr;
        }

        .stat-box {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-right: 1px solid #f1f2f6;
            transition: background 0.3s;
        }
        .stat-box:hover { background: #fdfdfd; }

        .stat-label { 
            font-size: 1.1rem; 
            color: #b2bec3; 
            margin-bottom: 5px; 
            font-weight: 700; 
            letter-spacing: 1px;
        }
        .stat-value { font-size: 3rem; font-weight: 900; color: var(--text-primary); line-height: 1;}
        .stat-value.expected { color: #0984e3; }
        .stat-value.actual { color: #00b894; }

        .stat-box.list-box {
            align-items: flex-start;
            padding: 20px 25px;
            overflow: hidden;
            border-right: none;
            background: #fdfdfd;
        }
        
        .absent-list { 
            font-size: 1.3rem; 
            color: #636e72; 
            font-weight: 700; 
            width: 100%;
            white-space: pre-wrap;
            line-height: 1.5;
        }

        /* --- è¨­å®šé¢æ¿ --- */
        #settings-panel {
            display: none;
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 40px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            border-radius: 20px; z-index: 2000; width: 550px;
            max-height: 90vh; overflow-y: auto;
            border: 1px solid white;
        }
        
        #settings-panel h2 { margin-top: 0; color: var(--text-primary); border-bottom: 2px solid #f1f2f6; padding-bottom: 15px; font-size: 1.8rem;}
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 700; color: var(--text-primary); font-size: 1.1rem;}
        .form-group input, .form-group textarea, .form-group select { 
            width: 100%; padding: 12px 15px; font-size: 1rem; box-sizing: border-box; 
            border: 2px solid #dfe6e9; border-radius: 10px; outline: none; transition: 0.3s;
            background: #fcfcfc; font-family: inherit;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { 
            border-color: var(--accent-color); 
            background: #fff;
            box-shadow: 0 0 0 4px rgba(9, 132, 227, 0.1);
        }
        
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #dfe6e9;
        }
        .checkbox-wrapper input[type="checkbox"] {
            width: 20px; height: 20px; margin: 0;
            accent-color: var(--accent-color);
        }
        .checkbox-wrapper label { margin: 0; cursor: pointer; display: inline-block; }

        .btn-group { display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px; }
        .btn { 
            padding: 12px 30px; 
            background: var(--accent-color); 
            color: white; border: none; border-radius: 10px; 
            cursor: pointer; font-size: 1.1rem; font-weight: 700; 
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(9, 132, 227, 0.3);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(9, 132, 227, 0.4); }
        .btn-close { background: #b2bec3; box-shadow: none; color: #2d3436;}
        .btn-close:hover { background: #dfe6e9; color: #000;}
        
        #config-btn { 
            position: fixed; bottom: 20px; right: 20px; 
            width: 50px; height: 50px; border-radius: 50%;
            background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer; font-size: 24px; border: none; 
            transition: all 0.3s; display: flex; align-items: center; justify-content: center;
            opacity: 0.5;
        }
        #config-btn:hover { opacity: 1; transform: rotate(90deg) scale(1.1); }
        
        .settings-highlight { background: #e3f2fd; padding: 20px; border-radius: 12px; border: 1px solid #bbdefb; margin-bottom: 25px;}

    </style>
</head>
<body>

    <div class="container">
        <!-- 1. æ™‚é˜å€ -->
        <div class="clock-section">
            <div class="clock-label">è‡ºä¸­å¸‚æ¸…æ°´å€è¥¿å¯§åœ‹å°</div>
            <div class="clock-time" id="clock">00:00:00</div>
        </div>

        <!-- 2. ä¸»è¨Šæ¯å€ -->
        <div class="message-section">
            <!-- Boss è¡€æ¢ -->
            <div class="boss-battle-area">
                <div class="boss-avatar anim-float" id="boss-icon" onclick="bossClickReaction()">â˜•</div>
                <div class="hp-container">
                    <div class="hp-text">
                        <span class="boss-name" id="boss-name">ä¼‘æ¯ä¸­</span>
                        <span class="boss-timer" id="boss-timer">--:--</span>
                    </div>
                    <div class="hp-bar-frame">
                        <div class="hp-bar-fill" id="hp-bar" style="width: 100%; background: #ccc;">
                            <!-- æé¾è·‘è€…ï¼šæ”¾åœ¨å¡«å……æ¢å…§éƒ¨ï¼Œé€é CSS å®šä½åœ¨æœ«ç«¯ -->
                            <div class="dino-runner" id="dino-icon">ğŸ¦–</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æé†’å¤§å­— -->
            <div class="reminder-area" id="reminder-container">
                <div id="main-reminder">
                    æº–å‚™è€ƒè©¦<br>è«‹ä¿æŒå®‰éœ
                </div>
            </div>
        </div>

        <!-- 3. èª²è¡¨å€ -->
        <div class="schedule-section" id="schedule-list">
            <!-- JS è‡ªå‹•ç”¢ç”Ÿ -->
        </div>

        <!-- 4. è€ƒå‹¤çµ±è¨ˆå€ -->
        <div class="attendance-section">
            <div class="stat-box">
                <div class="stat-label">æ‡‰åˆ°</div>
                <div class="stat-value expected" id="display-expected">30</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">å¯¦åˆ°</div>
                <div class="stat-value actual" id="display-actual">28</div>
            </div>
            <div class="stat-box list-box">
                <div class="absent-list" id="display-absent-list">
                    ç¼ºè€ƒåº§è™Ÿ:åŸå› 
                </div>
            </div>
        </div>
    </div>

    <!-- è¨­å®šæŒ‰éˆ• -->
    <button id="config-btn" onclick="openSettings()">âš™ï¸</button>

    <!-- è¨­å®šé¢æ¿ -->
    <div id="settings-panel">
        <h2>ğŸ”§ çœ‹æ¿è¨­å®š</h2>
        
        <div class="form-group settings-highlight">
            <label>ğŸ“… é¸æ“‡è€ƒç¨‹ (è‡ªå‹•è¼‰å…¥)</label>
            <div style="display: flex; gap: 15px;">
                <select id="select-grade">
                    <option value="high">é«˜å¹´ç´š (5-6å¹´ç´š)</option>
                    <option value="middle">ä¸­å¹´ç´š (3-4å¹´ç´š)</option>
                    <option value="low">ä½å¹´ç´š (1-2å¹´ç´š)</option>
                </select>
                <select id="select-day">
                    <option value="day1">ç¬¬ä¸€å¤©</option>
                    <option value="day2">ç¬¬äºŒå¤©</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label>ğŸ“¢ æé†’å¤§å­—</label>
            <textarea id="input-reminder" rows="2">æº–å‚™è€ƒè©¦&#10;è«‹ä¿æŒå®‰éœ</textarea>
            
            <div class="checkbox-wrapper">
                <input type="checkbox" id="input-reminder-marquee">
                <label for="input-reminder-marquee">é–‹å•Ÿè·‘é¦¬ç‡ˆæ¨¡å¼ (å–®è¡Œæ²å‹•)</label>
            </div>
        </div>

        <hr style="border: 0; border-top: 1px dashed #ccc; margin: 25px 0;">
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
            <div class="form-group" style="margin-bottom: 0;">
                <label>æ‡‰åˆ°äººæ•¸</label>
                <input type="number" id="input-expected" value="30">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <label>å¯¦åˆ°äººæ•¸</label>
                <input type="number" id="input-actual" value="28">
            </div>
        </div>
        
        <div class="form-group">
            <label>ğŸ“‹ ç¼ºè€ƒåå–®è³‡è¨Š</label>
            <textarea id="input-absent-list" rows="3">ç¼ºè€ƒåº§è™Ÿ:åŸå› </textarea>
        </div>
        
        <div class="btn-group">
            <button class="btn btn-close" onclick="closeSettings()">å–æ¶ˆ</button>
            <button class="btn" onclick="saveSettings()">å„²å­˜æ›´æ–°</button>
        </div>
    </div>

    <script>
        // --- è³‡æ–™åº«ï¼šè€ƒç¨‹è¡¨ ---
        const allSchedules = {
            "high": { 
                "day1": [
                    { subject: "åœ‹èª", start: "21:40", end: "22:20" },
                    { subject: "è‡ªç„¶", start: "09:30", end: "10:10" },
                    { subject: "è‹±èª", start: "10:30", end: "11:10" }
                ],
                "day2": [
                    { subject: "æ•¸å­¸", start: "08:40", end: "09:20" },
                    { subject: "ç¤¾æœƒ", start: "09:30", end: "10:10" }
                ]
            },
            "middle": { 
                "day1": [
                    { subject: "åœ‹èª", start: "08:40", end: "09:20" },
                    { subject: "è‡ªç„¶", start: "09:30", end: "10:10" },
                    { subject: "è‹±èª", start: "10:30", end: "11:10" }
                ],
                "day2": [
                    { subject: "æ•¸å­¸", start: "08:40", end: "09:20" },
                    { subject: "ç¤¾æœƒ", start: "09:30", end: "10:10" }
                ]
            },
            "low": { 
                "day1": [
                    { subject: "åœ‹èª", start: "08:40", end: "09:20" },
                    { subject: "ç”Ÿæ´»", start: "09:30", end: "10:10" }
                ],
                "day2": [
                    { subject: "æ•¸å­¸", start: "08:40", end: "09:20" }
                ]
            }
        };

        let currentSchedule = []; 

        // --- æ ¸å¿ƒé‚è¼¯ ---
        
        let clickCount = 0;
        let lastClickTime = 0;
        let reactionEndTime = 0;

        function updateTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('clock').innerText = `${hours}:${minutes}:${seconds}`;

            updateScheduleAndBoss(now);
        }

        function bossClickReaction() {
            const now = Date.now();
            if (now - lastClickTime > 2000) {
                clickCount = 0;
            }
            lastClickTime = now;
            clickCount++;

            if (clickCount >= 10) {
                reactionEndTime = now + 5000;
                clickCount = 0;
                updateTime();
            }
        }

        function renderSchedule() {
            const container = document.getElementById('schedule-list');
            container.innerHTML = ''; 
            
            if (currentSchedule.length === 0) {
                container.innerHTML = '<div style="margin:auto; text-align:center; color:#b2bec3; font-size: 1.5rem; font-weight:bold;">âœ¨ ä»Šæ—¥ç„¡è€ƒè©¦è¡Œç¨‹</div>';
                return;
            }

            currentSchedule.forEach((item, index) => {
                const row = document.createElement('div');
                row.className = 'schedule-row';
                row.id = `schedule-${index}`;
                row.innerHTML = `<div class="subject-name">${item.subject}</div><div class="subject-time">${item.start}~${item.end}</div>`;
                container.appendChild(row);
            });
        }

        function updateScheduleAndBoss(nowDate) {
            const currentTotalMin = nowDate.getHours() * 60 + nowDate.getMinutes();
            
            let isExamining = false;
            let activeSubject = null;

            currentSchedule.forEach((item, index) => {
                const row = document.getElementById(`schedule-${index}`);
                if(!row) return;

                row.classList.remove('active');

                const [sH, sM] = item.start.split(':').map(Number);
                const [eH, eM] = item.end.split(':').map(Number);
                const startMin = sH * 60 + sM;
                const endMin = eH * 60 + eM;

                if (currentTotalMin >= startMin && currentTotalMin < endMin) {
                    isExamining = true;
                    activeSubject = item;
                    row.classList.add('active');

                    // Boss è¡€æ¢è¨ˆç®—
                    const startTime = new Date(nowDate); startTime.setHours(sH, sM, 0);
                    const endTime = new Date(nowDate); endTime.setHours(eH, eM, 0);
                    
                    const totalDuration = (endTime - startTime) / 1000;
                    const elapsed = (nowDate - startTime) / 1000;
                    const remaining = totalDuration - elapsed;

                    let percentage = ((remaining / totalDuration) * 100).toFixed(1);
                    if (percentage < 0) percentage = 0;

                    updateBossUI(item.subject, percentage, remaining);
                }
            });

            if (!isExamining) {
                document.getElementById('boss-icon').innerText = "â˜•"; 
                document.getElementById('boss-icon').className = "boss-avatar anim-float";
                document.getElementById('boss-name').innerText = "ä¼‘æ¯æ™‚é–“ / æº–å‚™ä¸‹ä¸€ç§‘";
                document.getElementById('boss-timer').innerText = "";
                const bar = document.getElementById('hp-bar');
                bar.style.width = "100%";
                bar.style.background = "#b2bec3"; 
                
                // ä¼‘æ¯æ™‚é–“éš±è—æé¾
                document.getElementById('dino-icon').style.display = 'none';
            } else {
                // è€ƒè©¦æ™‚é–“é¡¯ç¤ºæé¾
                document.getElementById('dino-icon').style.display = 'block';
            }
        }

        function updateBossUI(subjectName, percentage, remainingSeconds) {
            const bossIcon = document.getElementById('boss-icon');
            const bossName = document.getElementById('boss-name');
            const bossTimer = document.getElementById('boss-timer');
            const hpBar = document.getElementById('hp-bar');

            // é è¨­åœ–ç¤ºèˆ‡ç‹€æ…‹ class
            let iconText = "ğŸ‘¾";
            let animClass = "anim-float"; 
            let colorVar = "";

            bossName.innerText = `BOSSï¼š${subjectName}`;
            
            const remMin = Math.floor(remainingSeconds / 60);
            const remSec = Math.floor(remainingSeconds % 60);
            const displaySec = String(remSec).padStart(2, '0');
            bossTimer.innerText = `å‰©é¤˜ HPï¼š${remMin}:${displaySec}`;

            hpBar.style.width = `${percentage}%`;

            if (percentage > 50) {
                colorVar = "var(--hp-high)"; 
                animClass = "anim-float"; 
            } else if (percentage > 20) {
                colorVar = "var(--hp-mid)";
                animClass = "anim-float"; 
            } else {
                colorVar = "var(--hp-low)";
                iconText = "ğŸ¥µ"; 
                animClass = "anim-shake"; 
            }

            // --- å½©è›‹é‚è¼¯ä»‹å…¥ ---
            if (Date.now() < reactionEndTime) {
                if (iconText === "ğŸ‘¾") {
                    iconText = "ğŸ˜¡"; 
                    animClass = "anim-angry"; 
                } else if (iconText === "ğŸ¥µ") {
                    iconText = "ğŸ˜­"; 
                    animClass = "anim-cry"; 
                }
            }
            
            bossIcon.innerText = iconText;
            bossIcon.className = `boss-avatar ${animClass}`;
            hpBar.style.background = colorVar;
        }

        // --- è¨­å®šé¢æ¿åŠŸèƒ½ ---
        
        function openSettings() { document.getElementById('settings-panel').style.display = 'block'; }
        function closeSettings() { document.getElementById('settings-panel').style.display = 'none'; }

        function saveSettings() {
            const reminderText = document.getElementById('input-reminder').value;
            const marqueeEnabled = document.getElementById('input-reminder-marquee').checked;
            
            const expected = document.getElementById('input-expected').value;
            const actual = document.getElementById('input-actual').value;
            const absentList = document.getElementById('input-absent-list').value;

            const reminderContainer = document.getElementById('reminder-container');
            const mainReminder = document.getElementById('main-reminder');

            if (marqueeEnabled) {
                reminderContainer.classList.add('marquee-active');
                mainReminder.innerText = reminderText.replace(/\n/g, '   ');
            } else {
                reminderContainer.classList.remove('marquee-active');
                mainReminder.innerText = reminderText; 
            }

            document.getElementById('display-expected').innerText = expected;
            document.getElementById('display-actual').innerText = actual;
            document.getElementById('display-absent-list').innerText = absentList;

            const selectedGrade = document.getElementById('select-grade').value;
            const selectedDay = document.getElementById('select-day').value;
            currentSchedule = allSchedules[selectedGrade][selectedDay];
            renderSchedule();

            localStorage.setItem('exam_board_grade', selectedGrade);
            localStorage.setItem('exam_board_day', selectedDay);
            localStorage.setItem('exam_board_reminder', reminderText);
            localStorage.setItem('exam_board_marquee', marqueeEnabled);
            localStorage.setItem('exam_board_expected', expected);
            localStorage.setItem('exam_board_actual', actual);
            localStorage.setItem('exam_board_absent_list', absentList);

            closeSettings();
        }

        function loadSavedSettings() {
            const savedGrade = localStorage.getItem('exam_board_grade') || 'high';
            const savedDay = localStorage.getItem('exam_board_day') || 'day1';
            
            document.getElementById('select-grade').value = savedGrade;
            document.getElementById('select-day').value = savedDay;
            currentSchedule = allSchedules[savedGrade][savedDay];
            
            const items = ['reminder', 'expected', 'actual', 'absent_list'];
            const defaults = {
                reminder: "æº–å‚™è€ƒè©¦\nè«‹ä¿æŒå®‰éœ",
                expected: "30",
                actual: "28",
                absent_list: "ç¼ºè€ƒåº§è™Ÿ:åŸå› "
            };
            const ids = {
                reminder: ['input-reminder', 'main-reminder'],
                expected: ['input-expected', 'display-expected'],
                actual: ['input-actual', 'display-actual'],
                absent_list: ['input-absent-list', 'display-absent-list']
            };

            items.forEach(key => {
                const savedVal = localStorage.getItem(`exam_board_${key}`);
                const val = savedVal !== null ? savedVal : defaults[key];
                document.getElementById(ids[key][0]).value = val;
                document.getElementById(ids[key][1]).innerText = val;
            });

            const marqueeEnabled = localStorage.getItem('exam_board_marquee') === 'true';
            document.getElementById('input-reminder-marquee').checked = marqueeEnabled;
            
            const reminderText = document.getElementById('input-reminder').value;
            const reminderContainer = document.getElementById('reminder-container');
            const mainReminder = document.getElementById('main-reminder');
            
            if (marqueeEnabled) {
                reminderContainer.classList.add('marquee-active');
                mainReminder.innerText = reminderText.replace(/\n/g, '   ');
            } else {
                reminderContainer.classList.remove('marquee-active');
                mainReminder.innerText = reminderText;
            }
        }

        window.onload = function() {
            loadSavedSettings(); 
            renderSchedule(); 
            setInterval(updateTime, 1000);
            updateTime();
        };

    </script>
</body>
</html>
